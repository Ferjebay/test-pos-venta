import{d as S,r as t,C as D,_ as M,o as y,a9 as $,g as r,f as a,ap as E,e as l,Q as p,i as q,h as C,ar as F,ad as R,c as L,aa as z,au as j,af as I,bj as J,ao as K,ab as N,ac as B}from"./index.9c5c742c.js";import{Q as W}from"./QSpace.6c16747b.js";import{Q,a as X,b as k}from"./QTable.28ce5880.js";import{Q as T}from"./QBadge.1183cf7c.js";import{Q as Y}from"./QPage.27f1013e.js";import{u as Z,Q as x}from"./useRolPermisos.8610c2bb.js";import{a as O,A as w,u as ee}from"./Api.dae86ed2.js";import{Q as G}from"./QForm.9649030d.js";import"./format.bda3f914.js";import"./auth-user.39da1b8c.js";import"./index.2cf0d985.js";const oe=S({name:"AgregarUsuario",setup(e,{emit:o}){const m=t({rol_id:"",pv_id:"",nombres:"",apellidos:"",cedula:"",celular:"",email:"",password:"",confirmPassword:""}),v=t([]),f=t(!1),b=t([]),s=O(),V=async()=>{try{const{data:{roles:n}}=await w.get("/roles");v.value=[],n.forEach(d=>{v.value.push({label:d.nombre,value:d.id})})}catch(n){console.log(n)}},i=async()=>{try{const{data:{puntos_ventas:n}}=await w.get("/puntos_ventas");b.value=[],n.forEach(d=>{b.value.push({label:d.nombre,value:d.id})})}catch(n){console.log(n)}};V(),i();const c=async()=>{if(m.value.password!==m.value.confirmPassword)return alert("Las contrase\xF1as no son iguales");try{f.value=!0,await w.post("/usuarios",m.value),o("actualizarLista"),s.notify({color:"positive",message:"Usuario Agregado Exitosamente",icon:"done"}),f.value=!1}catch(n){f.value=!1,s.notify({color:"warning",message:n.response.data.errors[0].msg,position:"top-right"})}};return D(m.value,(n,d)=>{m.value.nombres=n.nombres.toUpperCase(),m.value.apellidos=n.apellidos.toUpperCase()}),{listRoles:v,listPuntosVentas:b,loading:f,formUsuario:m,onSubmit:c,isPwd:t(!0),isPwd2:t(!0)}}}),le=l("div",{class:"text-h6"},"Agregar Usuario",-1),se={class:"row q-gutter-sm justify-around"},ae={class:"col-xs-12 col-sm-5"},ie=l("label",null,"Nombres:",-1),re={class:"col-xs-12 col-sm-5"},te=l("label",null,"Apellidos:",-1),ne={class:"col-xs-12 col-sm-5 q-my-md"},de=l("label",null,"Cedula:",-1),ue={class:"col-xs-12 col-sm-5 q-my-md"},me=l("label",null,"Celular:",-1),pe={class:"col-xs-12 col-sm-5 q-my-md"},ce=l("label",null,"Email:",-1),fe={class:"col-xs-12 col-sm-5 q-my-md"},ve=l("label",null,"Rol:",-1),Ue={class:"col-xs-12 col-sm-5 q-my-md"},be=l("label",null,"Contrase\xF1a:",-1),ge={class:"col-xs-12 col-sm-5 q-my-md"},ye=l("label",null,"Confirmar Contrase\xF1a:",-1),we={class:"col-xs-12 col-sm-5 q-my-md"},Ve=l("label",null,"Punto de Venta:",-1),$e={class:"col-xs-9 col-sm-12 flex justify-center"};function Ce(e,o,m,v,f,b){return y(),$(F,{style:{width:"700px","max-width":"80vw"}},{default:r(()=>[a(E,null,{default:r(()=>[le]),_:1}),a(E,null,{default:r(()=>[a(G,{onSubmit:e.onSubmit},{default:r(()=>[l("div",se,[l("div",ae,[ie,a(p,{modelValue:e.formUsuario.nombres,"onUpdate:modelValue":o[0]||(o[0]=s=>e.formUsuario.nombres=s),dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",re,[te,a(p,{modelValue:e.formUsuario.apellidos,"onUpdate:modelValue":o[1]||(o[1]=s=>e.formUsuario.apellidos=s),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",ne,[de,a(p,{modelValue:e.formUsuario.cedula,"onUpdate:modelValue":o[2]||(o[2]=s=>e.formUsuario.cedula=s),modelModifiers:{trim:!0},minlength:"10",maxlength:"10",type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",ue,[me,a(p,{modelValue:e.formUsuario.celular,"onUpdate:modelValue":o[3]||(o[3]=s=>e.formUsuario.celular=s),modelModifiers:{trim:!0},type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",pe,[ce,a(p,{modelValue:e.formUsuario.email,"onUpdate:modelValue":o[4]||(o[4]=s=>e.formUsuario.email=s),modelModifiers:{trim:!0},type:"email",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",fe,[ve,a(Q,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.rol_id,"onUpdate:modelValue":o[5]||(o[5]=s=>e.formUsuario.rol_id=s),options:e.listRoles},null,8,["modelValue","options"])]),l("div",Ue,[be,a(p,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.password,"onUpdate:modelValue":o[7]||(o[7]=s=>e.formUsuario.password=s),modelModifiers:{trim:!0},type:e.isPwd?"password":"text",required:""},{append:r(()=>[a(q,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[6]||(o[6]=s=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",ge,[ye,a(p,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.confirmPassword,"onUpdate:modelValue":o[9]||(o[9]=s=>e.formUsuario.confirmPassword=s),modelModifiers:{trim:!0},type:e.isPwd2?"password":"text",required:""},{append:r(()=>[a(q,{name:e.isPwd2?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[8]||(o[8]=s=>e.isPwd2=!e.isPwd2)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",we,[Ve,a(Q,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.pv_id,"onUpdate:modelValue":o[10]||(o[10]=s=>e.formUsuario.pv_id=s),options:e.listPuntosVentas},null,8,["modelValue","options"])]),l("div",$e,[a(C,{label:"Guardar",class:"q-px-xl",loading:e.loading,type:"submit",color:"green-9"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var qe=M(oe,[["render",Ce]]);const Pe=S({name:"EditarUsuario",props:["userData"],setup(e,{emit:o}){const{id:m,nombres:v,apellidos:f,cedula:b,celular:s,email:V,rol_id:i,pv_id:c}=e.userData,n=t(!1),d=t({rol_id:"",pv_id:c,nombres:v,apellidos:f,cedula:b,celular:s,email:V,password:"",confirmPassword:""}),h=t([]),_=t([]),u=O(),g=async()=>{try{const{data:{roles:U}}=await w.get("/roles");h.value=[],U.forEach(P=>{h.value.push({label:P.nombre,value:P.id})}),d.value.rol_id=i}catch(U){console.log(U)}},A=async()=>{try{const{data:{puntos_ventas:U}}=await w.get("/puntos_ventas");_.value=[],U.forEach(P=>{_.value.push({label:P.nombre,value:P.id})})}catch(U){console.log(U)}};g(),A();const H=async()=>{if(d.value.password.length!==0&&d.value.password!==d.value.confirmPassword)return alert("Las contrase\xF1as no son iguales");try{n.value=!0,await w.put(`/usuarios/${m}`,d.value),o("actualizarLista"),u.notify({color:"positive",message:"Usuario Editado Exitosamente",icon:"done"}),n.value=!1}catch(U){n.value=!1,u.notify({color:"warning",message:U.response.data.errors[0].msg,position:"top-right"})}};return D(d.value,(U,P)=>{d.value.nombres=U.nombres.toUpperCase(),d.value.apellidos=U.apellidos.toUpperCase()}),{listRoles:h,listPuntosVentas:_,loading:n,formUsuario:d,onSubmit:H,isPwd:t(!0),isPwd2:t(!0)}}}),he=l("div",{class:"text-h6"},"Editar Usuario",-1),_e={class:"row q-gutter-sm justify-around"},ke={class:"col-xs-12 col-sm-5"},Ee=l("label",null,"Nombres:",-1),Qe={class:"col-xs-12 col-sm-5"},Ae=l("label",null,"Apellidos:",-1),ze={class:"col-xs-12 col-sm-5 q-my-md"},Se=l("label",null,"Cedula:",-1),De={class:"col-xs-12 col-sm-5 q-my-md"},Me=l("label",null,"Celular:",-1),Re={class:"col-xs-12 col-sm-5 q-my-md"},Le=l("label",null,"Email:",-1),je={class:"col-xs-12 col-sm-5 q-my-md"},Ie=l("label",null,"Rol:",-1),Ne={class:"col-xs-12 col-sm-5 q-my-md"},Be=l("label",null,"Cambiar Contrase\xF1a (Opcional):",-1),Te={class:"col-xs-12 col-sm-5 q-my-md"},Fe=l("label",null,"Confirmar Contrase\xF1a:",-1),Oe={class:"col-xs-12 col-sm-5 q-my-md"},Ge=l("label",null,"Punto de Venta:",-1),He={class:"col-xs-9 col-sm-12 flex justify-center"};function Je(e,o,m,v,f,b){return y(),$(F,{style:{width:"700px","max-width":"80vw"}},{default:r(()=>[a(E,null,{default:r(()=>[he]),_:1}),a(E,null,{default:r(()=>[a(G,{onSubmit:e.onSubmit},{default:r(()=>[l("div",_e,[l("div",ke,[Ee,a(p,{modelValue:e.formUsuario.nombres,"onUpdate:modelValue":o[0]||(o[0]=s=>e.formUsuario.nombres=s),dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Qe,[Ae,a(p,{modelValue:e.formUsuario.apellidos,"onUpdate:modelValue":o[1]||(o[1]=s=>e.formUsuario.apellidos=s),modelModifiers:{trim:!0},dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",ze,[Se,a(p,{modelValue:e.formUsuario.cedula,"onUpdate:modelValue":o[2]||(o[2]=s=>e.formUsuario.cedula=s),modelModifiers:{trim:!0},minlength:"10",maxlength:"10",type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",De,[Me,a(p,{modelValue:e.formUsuario.celular,"onUpdate:modelValue":o[3]||(o[3]=s=>e.formUsuario.celular=s),modelModifiers:{trim:!0},type:"number",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",Re,[Le,a(p,{modelValue:e.formUsuario.email,"onUpdate:modelValue":o[4]||(o[4]=s=>e.formUsuario.email=s),modelModifiers:{trim:!0},type:"email",dense:"",filled:"",required:""},null,8,["modelValue"])]),l("div",je,[Ie,a(Q,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.rol_id,"onUpdate:modelValue":o[5]||(o[5]=s=>e.formUsuario.rol_id=s),options:e.listRoles},null,8,["modelValue","options"])]),l("div",Ne,[Be,a(p,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.password,"onUpdate:modelValue":o[7]||(o[7]=s=>e.formUsuario.password=s),modelModifiers:{trim:!0},type:e.isPwd?"password":"text"},{append:r(()=>[a(q,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[6]||(o[6]=s=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",Te,[Fe,a(p,{dense:"",filled:"",placeholder:"********",modelValue:e.formUsuario.confirmPassword,"onUpdate:modelValue":o[9]||(o[9]=s=>e.formUsuario.confirmPassword=s),modelModifiers:{trim:!0},type:e.isPwd2?"password":"text"},{append:r(()=>[a(q,{name:e.isPwd2?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[8]||(o[8]=s=>e.isPwd2=!e.isPwd2)},null,8,["name"])]),_:1},8,["modelValue","type"])]),l("div",Oe,[Ge,a(Q,{filled:"",required:"",dense:"","emit-value":"","map-options":"",modelValue:e.formUsuario.pv_id,"onUpdate:modelValue":o[10]||(o[10]=s=>e.formUsuario.pv_id=s),options:e.listPuntosVentas},null,8,["modelValue","options"])]),l("div",He,[a(C,{label:"Editar",class:"q-px-xl",loading:e.loading,type:"submit",color:"green-9"},null,8,["loading"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var Ke=M(Pe,[["render",Je]]);const We=[{name:"id",label:"#",align:"left",field:"id",sortable:!0},{name:"usuario",label:"Usuario",align:"left",field:"usuario",sortable:!0},{name:"rol",align:"center",label:"Rol",field:"rol"},{name:"pv",align:"center",label:"Punto de Venta",field:"punto_venta"},{name:"email",label:"Email",field:"email",align:"center"},{name:"cedula",label:"Cedula",field:"cedula",align:"center"},{name:"celular",label:"Celular",field:"celular",align:"center"},{name:"estado",label:"Estado",align:"center",field:"estado"},{name:"acciones",label:"acciones",align:"center"}],Xe=S({name:"IndexUsuario",components:{AgregarUsuario:qe,EditarUsuario:Ke},setup(){const{validarPermisos:e}=Z(),o=t(""),m=t([]),v=t(!0),{mostrarNotify:f}=ee(),b=t(!1),s=t(!1),V=t({}),i=t({nombres:"",apellidos:"",cedula:"",celular:"",email:"",password:""}),c=async()=>{b.value=!1,s.value=!1,v.value=!0;try{const{data:{usuarios:u}}=await w.get("/usuarios");u.map(g=>g.usuario=`${g.nombres} ${g.apellidos}`),m.value=u}catch(u){console.log(u)}v.value=!1};c();const n=async(u,g)=>{try{await w.delete(`/usuarios/${u}/${g}`),f("positive",`Usuario ${g?"Activado":"Inactivado"} exitosamente`),c()}catch(A){console.log(A)}},d=async u=>{J.create({title:"\xBFDeseas Eliminar a este usuario?",message:"Una vez eliminado no podra recuperarse...!",ok:{push:!0,label:"Eliminar",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{await w.delete(`/usuarios/${u}`),f("positive","Usuario eliminado exitosamente"),c()}catch(g){f("negative",g.response.data.message)}})},h=async()=>{const u=await w.post("/usuarios",i.value);console.log(u)},_=u=>{V.value=u,s.value=!0};return D(i.value,(u,g)=>{i.value.nombres=u.nombres.toUpperCase(),i.value.apellidos=u.apellidos.toUpperCase()}),{editarUsuario:_,eliminarUsuario:d,modalCrearUsuario:b,modalEditarUsuario:s,activarDesactivarUser:n,columns:We,formUsuario:i,filter:o,loading:v,getUsuarios:c,onSubmit:h,isPwd:t(!0),rows:m,userData:V,validarPermisos:e}}}),Ye=l("div",{class:"col-md-6"},[l("label",{class:"text-h6"},"Listado de Usuarios")],-1),Ze={class:"col-md-6 flex justify-end"},xe={class:"row"},eo={class:"col-md-12 col-xs-12"},oo={class:"q-pa-md"},lo={class:"full-width row flex-center text-lime-10 q-gutter-sm"},so=l("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1);function ao(e,o,m,v,f,b){const s=R("AgregarUsuario"),V=R("EditarUsuario");return y(),L(I,null,[a(Y,null,{default:r(()=>[l("div",{class:K(["row q-py-lg q-pl-md",e.$q.screen.xs?"justify-center":"justify-between"])},[Ye,l("div",Ze,[e.validarPermisos("Agregar Usuario")&&!e.$q.screen.xs?(y(),$(C,{key:0,color:"secondary","icon-right":"person_add",label:"Agregar Usuario",class:"q-mr-md",onClick:o[0]||(o[0]=i=>e.modalCrearUsuario=!e.modalCrearUsuario)})):z("",!0)])],2),l("div",xe,[l("div",eo,[l("div",oo,[a(X,{class:"my-sticky-header-table",rows:e.rows,columns:e.columns,loading:e.loading,filter:e.filter,"row-key":"name"},{top:r(()=>[a(W),a(p,{dense:"",debounce:"300",color:"primary",modelValue:e.filter,"onUpdate:modelValue":o[1]||(o[1]=i=>e.filter=i),label:"Buscar Usuario"},{append:r(()=>[a(q,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-id":r(i=>[a(k,{props:i},{default:r(()=>[N(B(i.pageIndex+1),1)]),_:2},1032,["props"])]),"body-cell-pv":r(i=>[a(k,{props:i},{default:r(()=>[N(B(i.row.punto_venta),1)]),_:2},1032,["props"])]),"body-cell-estado":r(i=>[a(k,{props:i},{default:r(()=>[i.value?(y(),$(T,{key:0,outline:"",color:"positive",label:"Activo",class:"q-pa-sm"})):(y(),$(T,{key:1,outline:"",color:"red",label:"Inactivo",class:"q-pa-sm"}))]),_:2},1032,["props"])]),"body-cell-acciones":r(i=>[a(k,{props:i},{default:r(()=>[e.validarPermisos("Editar Usuario")&&i.row.estado?(y(),$(C,{key:0,round:"",color:"primary",onClick:c=>e.editarUsuario(i.row),icon:"edit",class:"q-mr-sm",size:"11px"},null,8,["onClick"])):z("",!0),i.row.estado?(y(),$(C,{key:1,round:"",color:"blue-grey",icon:"close",onClick:c=>e.activarDesactivarUser(i.row.id,!1),size:"11px"},null,8,["onClick"])):(y(),L(I,{key:2},[a(C,{round:"",color:"positive",class:"q-mr-sm",icon:"done",onClick:c=>e.activarDesactivarUser(i.row.id,!0),size:"11px"},null,8,["onClick"]),a(C,{round:"",color:"deep-orange",icon:"delete",onClick:c=>e.eliminarUsuario(i.row.id),size:"11px"},null,8,["onClick"])],64))]),_:2},1032,["props"])]),"no-data":r(({icon:i,filter:c})=>[l("div",lo,[a(q,{size:"2em",name:"sentiment_dissatisfied"}),so,a(q,{size:"2em",name:c?"filter_b_and_w":i},null,8,["name"])])]),_:1},8,["rows","columns","loading","filter"])])])])]),_:1}),e.$q.screen.xs&&e.validarPermisos("Agregar Usuario")?(y(),$(x,{key:0,position:"bottom-right",offset:[18,18]},{default:r(()=>[a(C,{round:"",color:"secondary",size:"lg",icon:"add",onClick:o[2]||(o[2]=i=>e.modalCrearUsuario=!e.modalCrearUsuario)})]),_:1})):z("",!0),a(j,{modelValue:e.modalCrearUsuario,"onUpdate:modelValue":o[3]||(o[3]=i=>e.modalCrearUsuario=i)},{default:r(()=>[a(s,{onActualizarLista:e.getUsuarios},null,8,["onActualizarLista"])]),_:1},8,["modelValue"]),a(j,{modelValue:e.modalEditarUsuario,"onUpdate:modelValue":o[4]||(o[4]=i=>e.modalEditarUsuario=i)},{default:r(()=>[a(V,{userData:e.userData,onActualizarLista:e.getUsuarios},null,8,["userData","onActualizarLista"])]),_:1},8,["modelValue"])],64)}var bo=M(Xe,[["render",ao]]);export{bo as default};
