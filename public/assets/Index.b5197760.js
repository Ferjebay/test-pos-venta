import{l as X,S as Z,aJ as ee,U as ae,aL as te,m as T,n as S,aR as le,z as se,bi as oe,d as Q,r as m,_ as E,o as y,a9 as x,g as l,f as a,ap as L,e as t,ac as f,ab as b,ao as B,ar as ne,c as J,i as $,Y as z,h as w,Q as P,an as re,w as ie,aa as q,u as de,a as ue,C as ce,ad as R,au as me,af as pe,as as fe,at as ge}from"./index.9c5c742c.js";import{Q as F}from"./QBadge.1183cf7c.js";import{Q as be}from"./QSpace.6c16747b.js";import{a as j,b as _,Q as _e}from"./QTable.28ce5880.js";import{Q as ve}from"./QPage.27f1013e.js";import{u as he,Q as Ve}from"./useRolPermisos.8610c2bb.js";import{A,u as H,a as ye}from"./Api.dae86ed2.js";import{Q as M,a as O,C as U}from"./ClosePopup.66fa040f.js";import{Q as $e,d as we}from"./format.bda3f914.js";import{u as De}from"./auth-user.39da1b8c.js";import"./index.2cf0d985.js";import"./date.bb3e7fb1.js";var Fe=X({name:"QInnerLoading",props:{...Z,...ee,showing:Boolean,color:String,size:{type:[String,Number],default:42},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:n}){const r=se(),c=ae(e,r.proxy.$q),{transitionProps:d,transitionStyle:p}=te(e),s=T(()=>"q-inner-loading absolute-full column flex-center"+(c.value===!0?" q-inner-loading--dark":"")),v=T(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function o(){const D=[S(oe,{size:e.size,color:e.color})];return e.label!==void 0&&D.push(S("div",{class:v.value,style:e.labelStyle},[e.label])),D}function g(){return e.showing===!0?S("div",{class:s.value,style:p.value},n.default!==void 0?n.default():o()):null}return()=>S(le,d.value,g)}});const xe=[{name:"indice",label:"#",sortable:!0},{name:"marca",align:"center",label:"MARCA",field:"marca"},{name:"modelo",label:"MODELO",field:"modelo",align:"center"},{name:"imei",label:"IMEI",field:"imei",align:"center"},{name:"detalle",label:"DETALLE",field:"detalle",align:"center"},{name:"precio_base",label:"PRECIO BASE",align:"center",field:"precio_base"},{name:"estadoVenta",label:"ESTADO DE VENTA",align:"center",field:"estadoVenta"},{name:"total",label:"TOTAL",align:"center",field:"total"}],Ae=Q({name:"detalleFactura",props:["facturaData"],setup(e){const n=m([]),r=m(!1);return(async()=>{try{r.value=!0;const{data:d}=await A.get(`/ventas/${e.facturaData.id}`);n.value=d.detalleVenta,r.value=!1}catch(d){r.value=!1,console.log(d)}})(),{columns:xe,loading:r,rows:n}}}),Ce=t("div",{class:"text-h6 text-center"},"Detalle de la Factura",-1),Se={class:"row q-gutter-sm justify-around"},qe=t("div",{class:"col-sm-4 text-right"},[t("label",{class:"text-subtitle1 text-weight-medium"},"Num. Comprobantes:")],-1),ke={class:"col-sm-5 flex text-left"},Ie=t("div",{class:"col-sm-4 text-right"},[t("label",{class:"text-subtitle1 text-weight-medium"},"Punto de Venta:")],-1),Pe={class:"col-sm-5 flex text-left"},Qe=t("div",{class:"col-sm-4 text-right"},[t("label",{class:"text-subtitle1 text-weight-medium"},"Cliente:")],-1),Ee={class:"col-sm-5 flex text-left"},Ne=t("div",{class:"col-sm-4 text-right"},[t("label",{class:"text-subtitle1 text-weight-medium"},"Usuario:")],-1),Te={class:"col-sm-5 flex text-left"},Le=t("div",{class:"col-sm-4 text-right"},[t("label",{class:"text-subtitle1 text-weight-medium"},"Fecha:")],-1),ze={class:"col-sm-5 flex text-left"},Re=t("div",{class:"col-sm-4 text-right"},[t("label",{class:"text-subtitle1 text-weight-medium"},"Total de Pago:")],-1),Me={class:"col-sm-5 flex text-left"},Oe={class:"col-sm-12 q-my-sm"};function Ue(e,n,r,c,d,p){return y(),x(ne,{style:{width:"840px","max-width":"80vw"}},{default:l(()=>[a(L,null,{default:l(()=>[Ce]),_:1}),a(L,null,{default:l(()=>[t("div",Se,[qe,t("div",ke,[t("label",null,f(e.facturaData.num_comprobante),1)]),Ie,t("div",Pe,[t("label",null,f(e.facturaData.pv_nombre),1)]),Qe,t("div",Ee,[t("label",null,f(e.facturaData.cliente),1)]),Ne,t("div",Te,[t("label",null,f(e.facturaData.usuario),1)]),Le,t("div",ze,[t("label",null,f(e.facturaData.fecha),1)]),Re,t("div",Me,[a(F,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${e.facturaData.totalPago.toFixed(2)}`},null,8,["label"])]),t("div",Oe,[a(j,{class:"my-sticky-header-table2",rows:e.rows,columns:e.columns,loading:e.loading,"hide-bottom":"","row-key":"name"},{"body-cell-indice":l(s=>[a(_,{props:s},{default:l(()=>[b(f(s.pageIndex+1),1)]),_:2},1032,["props"])]),"body-cell-detalle":l(s=>[a(_,{props:s},{default:l(()=>[b(f(s.row.detalle==""?"Sin Detalle":s.row.detalle),1)]),_:2},1032,["props"])]),"body-cell-precio_base":l(s=>[a(_,{props:s},{default:l(()=>[b(" $"+f(s.row.precio_base.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-estadoVenta":l(s=>[a(_,{props:s,class:B(["estadoVenta",s.row.estadoVenta>0?"text-green-8":"text-negative"])},{default:l(()=>[b(" $"+f(s.row.estadoVenta.toFixed(2)),1)]),_:2},1032,["props","class"])]),"body-cell-total":l(s=>[a(_,{props:s},{default:l(()=>[b("$"+f(s.row.total.toFixed(2)),1)]),_:2},1032,["props"])]),loading:l(()=>[a(Fe,{showing:"",color:"primary"})]),_:1},8,["rows","columns","loading"])])])]),_:1})]),_:1})}var Be=E(Ae,[["render",Ue]]);const Je=Q({name:"FiltrarVentas",props:["user"],setup(e,{emit:n}){const r=m({desde:"",hasta:"",pv_id:""}),c=m([]),d=m(!1),{mostrarNotify:p}=H(),s=async()=>{try{const{data:{pv:o}}=await A.get("/ventas/getPV");c.value=[],o.forEach(g=>{c.value.push({label:g.nombre,value:g.id})})}catch(o){console.log(o)}},v=async()=>{if(r.value.desde!=""&&r.value.hasta==""||r.value.desde==""&&r.value.hasta!="")return p("warning","Completa los campos de fecha de busqueda");if(r.value.desde>r.value.hasta)return p("warning","Error en el rango de fecha de busqueda");if(e.user.rol_name=="INDEPENDIENTE"&&(r.value.pv_id=e.user.pv_id),(e.user.rol_name=="SUPER-ADMINISTRADOR"||e.user.rol_name=="ADMINISTRADOR")&&r.value.desde==""&&r.value.hasta==""&&r.value.pv_id=="")return n("actualizarLista",{facturas:[]});d.value=!0;try{const{data:o}=await A.post("/ventas/consulta",r.value);n("actualizarLista",o)}catch(o){console.log(o)}d.value=!1};return s(),{listPV:c,loading:d,filtarVentas:v,formFiltrarVentas:r,myLocale:{days:"Domingo_Lunes_Martes_Mi\xE9rcoles_Jueves_Viernes_S\xE1bado".split("_"),daysShort:"Dom_Lun_Mar_Mi\xE9_Jue_Vie_S\xE1b".split("_"),months:"Enero_Febrero_Marzo_Abril_Mayo_Junio_Julio_Agosto_Septiembre_Octubre_Noviembre_Diciembre".split("_"),monthsShort:"Ene_Feb_Mar_Abr_May_Jun_Jul_Ago_Sep_Oct_Nov_Dic".split("_"),firstDayOfWeek:1,format24h:!0,pluralDay:"dias"}}}}),je={class:"col-md-9 flex items-center"},He=t("label",null,"Filtrar Por:",-1),Ge={class:"row items-center justify-end"},We=t("label",{class:"q-mx-md"},"HASTA:",-1),Ye={class:"row items-center justify-end"};function Ke(e,n,r,c,d,p){return y(),J("div",je,[He,a(P,{class:"q-ml-md",style:{width:"20%"},filled:"",modelValue:e.formFiltrarVentas.desde,"onUpdate:modelValue":n[1]||(n[1]=s=>e.formFiltrarVentas.desde=s),dense:"",mask:"date",clearable:"","clear-icon":"close"},{append:l(()=>[a($,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(O,{modelValue:e.formFiltrarVentas.desde,"onUpdate:modelValue":n[0]||(n[0]=s=>e.formFiltrarVentas.desde=s),locale:e.myLocale},{default:l(()=>[t("div",Ge,[z(a(w,{label:"Cerrar",color:"primary",flat:""},null,512),[[U]])])]),_:1},8,["modelValue","locale"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),We,a(P,{filled:"",style:{width:"20%"},modelValue:e.formFiltrarVentas.hasta,"onUpdate:modelValue":n[3]||(n[3]=s=>e.formFiltrarVentas.hasta=s),dense:"",mask:"date",clearable:"","clear-icon":"close"},{append:l(()=>[a($,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(O,{modelValue:e.formFiltrarVentas.hasta,"onUpdate:modelValue":n[2]||(n[2]=s=>e.formFiltrarVentas.hasta=s),locale:e.myLocale},{default:l(()=>[t("div",Ye,[z(a(w,{label:"Cerrar",color:"primary",flat:""},null,512),[[U]])])]),_:1},8,["modelValue","locale"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e.user.rol_name=="ADMINISTRADOR"||e.user.rol_name=="SUPER-ADMINISTRADOR"?(y(),x(_e,{key:0,filled:"",required:"",dense:"","emit-value":"","map-options":"",style:{width:"29%","margin-left":"27px"},modelValue:e.formFiltrarVentas.pv_id,"onUpdate:modelValue":n[5]||(n[5]=s=>e.formFiltrarVentas.pv_id=s),options:e.listPV},re({"no-option":l(()=>[a(we,null,{default:l(()=>[a($e,{class:"text-grey"},{default:l(()=>[b(" No hay resultados ")]),_:1})]),_:1})]),_:2},[e.formFiltrarVentas.pv_id!==""?{name:"append",fn:l(()=>[a($,{name:"cancel",onClick:n[4]||(n[4]=ie(s=>e.formFiltrarVentas.pv_id="",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options"])):q("",!0),a(w,{round:"",color:"black",icon:"search",loading:e.loading,class:"q-ml-md",onClick:e.filtarVentas},null,8,["loading","onClick"])])}var Xe=E(Je,[["render",Ke]]);const Ze=[{name:"acciones",label:"acciones",align:"center"},{name:"punto_venta",label:"Punto de Venta",align:"center",field:"pv_nombre"},{name:"num_comprobante",label:"Num Comprobante",field:"num_comprobante"},{name:"usuario",label:"Usuario",align:"center",field:"usuario"},{name:"cliente",label:"Cliente",align:"center",field:"cliente"},{name:"fecha",label:"Fecha/Hora",align:"center",field:"fecha"},{name:"estadoVenta",label:"Estado de Venta",align:"center",field:"estadoVenta"},{name:"total",label:"Total",field:"totalPago"},{name:"estado",label:"Estado",field:"estado",align:"center"}],ea=Q({name:"IndexVentas",components:{DetalleFactura:Be,FiltrarVentas:Xe},setup(){const e=m([]),n=de(),r=m(!1),c=m(0),d=m(0),p=m(0),s=m(""),v=m({}),{validarPermisos:o}=he(),{mostrarNotify:g}=H(),D=ye(),G=De(),C=m(!1),{claim:{user:N}}=ue.read(G.token),I=async()=>{try{C.value=!0;const{data:i}=await A.post("/ventas/consulta",{pv_id:N.pv_id,filter:s.value});c.value=0,d.value=i.estadoVentas.ganancias==null?0:i.estadoVentas.ganancias,p.value=i.estadoVentas.perdidas==null?0:i.estadoVentas.perdidas,i.facturas.map(u=>{u.estado&&(c.value+=u.totalPago);const h=u.fecha.split("T")[0].split("-"),V=u.hora.split(":");u.fecha=`${h[2]}/${h[1]}/${h[0]}  ${V[0]}:${V[1]} ${V[0]<12?"am":"pm"}`}),e.value=i.facturas,C.value=!1}catch(i){console.log(i),C.value=!1}},W=i=>{D.dialog({title:"<center>\xBFEstas Seguro de anular esta Factura?</center>",message:`<span><strong>Num Comprobante</strong>: ${i.num_comprobante}</span> <br>
                <span class='q-my-lg'><strong>Cliente</strong>: ${i.cliente}</span> <br>
                <span class='q-my-lg'><strong>Fecha/Hora</strong>: ${i.fecha}</span> <br>
                <span><strong>Total</strong>: $${i.totalPago}</span> <br>`,html:!0,ok:{push:!0,label:"Anular",color:"teal-7"},cancel:{push:!0,color:"blue-grey-8",label:"Cancelar"}}).onOk(async()=>{try{D.loading.show({message:"Cargando..."}),await A.put(`/ventas/${i.id}`),g("positive","Factura Anulada exitosamente"),I(),D.loading.hide()}catch(u){console.log(u)}})},Y=i=>{r.value=!0,v.value=i},K=i=>{c.value=0,d.value=i.estadoVentas?i.estadoVentas.ganancias:0,p.value=i.estadoVentas?i.estadoVentas.perdidas:0,e.value=i.facturas,i.facturas.map(u=>{u.estado&&(c.value+=u.totalPago);const h=u.fecha.split("T")[0].split("-"),V=u.hora.split(":");u.fecha=`${h[2]}/${h[1]}/${h[0]}  ${V[0]}:${V[1]} ${V[0]<12?"am":"pm"}`,u.estadoVenta=u.estadoVenta.toFixed(2)})};return I(),ce(s,(i,u)=>{I()}),{actualizarLista:K,anularFactura:W,columns:Ze,mostrarDetalleFactura:Y,modalDetalleFactura:r,loading:C,ganancias:d,perdidas:p,facturaData:v,filter:s,rows:e,router:n,totalVentas:c,validarPermisos:o,user:N}}}),k=e=>(fe("data-v-8a44535e"),e=e(),ge(),e),aa={class:"row q-py-lg q-pl-md"},ta={class:"col-md-3 flex justify-end"},la={class:"row"},sa={class:"col-md-12 col-xs-12"},oa={class:"q-pa-md"},na={class:"q-mr-xl text-h5 text-weight-regular"},ra={class:"q-ml-sm text-subtitle1"},ia=k(()=>t("b",null,"TOTAL DE VENTAS:",-1)),da={class:"q-ml-lg text-subtitle1"},ua=k(()=>t("b",null,"GANANCIA:",-1)),ca={class:"q-ml-lg text-subtitle1"},ma=k(()=>t("b",null,"PERDIDA:",-1)),pa={class:"full-width row flex-center text-lime-10 q-gutter-sm"},fa=k(()=>t("span",{class:"text-subtitle1"}," No se encontr\xF3 ningun Resultado ",-1));function ga(e,n,r,c,d,p){const s=R("FiltrarVentas"),v=R("DetalleFactura");return y(),J(pe,null,[a(ve,null,{default:l(()=>[t("div",aa,[a(s,{onActualizarLista:e.actualizarLista,user:e.user},null,8,["onActualizarLista","user"]),t("div",ta,[e.validarPermisos("Agregar Venta")&&!e.$q.screen.xs?(y(),x(w,{key:0,color:"secondary",label:"nueva Venta",class:"q-mr-md",onClick:n[0]||(n[0]=o=>e.$router.push("/ventas/add"))})):q("",!0)])]),t("div",la,[t("div",sa,[t("div",oa,[a(j,{class:"my-sticky-header-table",rows:e.rows,columns:e.columns,loading:e.loading,"row-key":"name"},{top:l(()=>[t("label",na,[b("Listado de Ventas "),a($,{name:"fa fa fa-cash-register",size:"30px",color:"secondary"})]),t("label",ra,[ia,a(F,{outline:"",class:"q-px-md text-subtitle1 q-ml-sm text-weight-bold",color:"blue-grey",label:`$${e.totalVentas.toFixed(2)}`},null,8,["label"])]),t("label",da,[ua,a(F,{outline:"",class:"q-px-md text-subtitle1 q-ml-sm text-weight-bold",color:"positive",label:`$${e.ganancias==null?0:e.ganancias.toFixed(2)}`},null,8,["label"])]),t("label",ca,[ma,a(F,{outline:"",class:"q-px-md text-subtitle1 q-ml-sm text-weight-bold",color:"red-9",label:`$${e.perdidas==null?0:e.perdidas.toFixed(2)}`},null,8,["label"])]),a(be),a(P,{dense:"",debounce:"1000",color:"primary",modelValue:e.filter,"onUpdate:modelValue":n[1]||(n[1]=o=>e.filter=o)},{append:l(()=>[a($,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-estadoVenta":l(o=>[a(_,{props:o,class:B(["estadoVenta",o.row.estadoVenta>0?"text-green-8":"text-negative"])},{default:l(()=>[b(" $"+f(o.row.estadoVenta!==null?parseFloat(o.row.estadoVenta).toFixed(2):0),1)]),_:2},1032,["props","class"])]),"body-cell-total":l(o=>[a(_,{props:o,class:"totalVenta text-weight-regular"},{default:l(()=>[b(" $"+f(o.row.totalPago.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-estado":l(o=>[a(_,{props:o},{default:l(()=>[a(F,{outline:"",class:"q-py-xs q-px-md",color:o.row.estado?"secondary":"negative",label:o.row.estado?"Aceptado":"Anulado"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-acciones":l(o=>[a(_,{props:o},{default:l(()=>[a(w,{round:"",color:"blue-grey",icon:"visibility",onClick:g=>e.mostrarDetalleFactura(o.row),class:"q-mr-sm",size:"10px"},null,8,["onClick"]),o.row.estado?(y(),x(w,{key:0,round:"",color:"blue-grey",icon:"close",onClick:g=>e.anularFactura(o.row),size:"10px"},null,8,["onClick"])):q("",!0)]),_:2},1032,["props"])]),"no-data":l(({icon:o,filter:g})=>[t("div",pa,[a($,{size:"2em",name:"sentiment_dissatisfied"}),fa,a($,{size:"2em",name:g?"filter_b_and_w":o},null,8,["name"])])]),_:1},8,["rows","columns","loading"])])])])]),_:1}),e.$q.screen.xs&&e.validarPermisos("Agregar Venta")?(y(),x(Ve,{key:0,position:"bottom-right",offset:[18,18]},{default:l(()=>[a(w,{round:"",color:"secondary",size:"lg",icon:"add",onClick:n[2]||(n[2]=o=>e.$router.push("/ventas/add"))})]),_:1})):q("",!0),a(me,{modelValue:e.modalDetalleFactura,"onUpdate:modelValue":n[3]||(n[3]=o=>e.modalDetalleFactura=o)},{default:l(()=>[a(v,{facturaData:e.facturaData},null,8,["facturaData"])]),_:1},8,["modelValue"])],64)}var Ca=E(ea,[["render",ga],["__scopeId","data-v-8a44535e"]]);export{Ca as default};
