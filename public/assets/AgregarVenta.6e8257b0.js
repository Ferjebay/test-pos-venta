import{n as d,l as P,bk as z,bl as R,_ as Y,d as K,r as p,u as j,a as G,m as H,ad as J,o as C,c as Q,f as s,g as n,au as W,af as X,e as t,ab as S,ac as I,a9 as q,an as Z,i as A,w as ee,h as x,Q as F,aq as te,aa as ae,ao as oe,as as le,at as se}from"./index.0d16ed78.js";import{d as ne,Q as ie}from"./format.cfb9ca0d.js";import{Q as re,a as de,b as _}from"./QTable.515a4d9f.js";import{Q as ue}from"./QBadge.cb33406e.js";import{Q as ce}from"./QForm.fb098f11.js";import{Q as me}from"./QPage.30b92492.js";import{u as pe,a as ge,A as V}from"./Api.96c094f1.js";import{u as fe}from"./auth-user.ae10ce8a.js";import{d as ve}from"./date.b3d8e0d8.js";import{A as he}from"./Add.c648ccfa.js";import"./index.2cf0d985.js";const _e=[d("g",{transform:"translate(20 50)"},[d("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.6"},[d("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),d("g",{transform:"translate(50 50)"},[d("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.8"},[d("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.1s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),d("g",{transform:"translate(80 50)"},[d("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.9"},[d("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.2s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])])];var be=P({name:"QSpinnerFacebook",props:z,setup(e){const{cSize:l,classes:v}=R(e);return()=>d("svg",{class:v.value,width:l.value,height:l.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},_e)}});const ye=[{name:"acciones",label:"Quitar",align:"left"},{name:"marca",label:"Marca",align:"left",field:"marca"},{name:"modelo",label:"Modelo",align:"left",field:"modelo"},{name:"imei",label:"IMEI",align:"left",field:"imei"},{name:"detalle",label:"Detalles",align:"center"},{name:"estado_ingreso",label:"Estado de Ingreso",align:"center"},{name:"precio_base",label:"Precio Base",align:"left",field:"precio_base"},{name:"precio_venta",label:"Precio Venta",align:"left"}];let $=[];const we=K({name:"AddVentas",components:{Add:he},setup(){const e=p([]),l=p([]),v=p(!1),b=p(!1),u=p(!1),{mostrarNotify:c}=pe(),f=ge();let o="";const i=p({cliente_id:"CONSUMIDOR FINAL",numComprobante:""}),h=p(""),E=Date.now();o=ve.formatDate(E,"DD/MM/YYYY");const M=j(),O=fe(),{claim:{user:y}}=G.read(O.token),T=async()=>{if(h.value.length==0)return c("warning","Ingresa el codigo IMEI");try{u.value=!0;const{data:a}=await V.get(`/articulos/${h.value}`);if(a.articulo.length==0)return u.value=!1,c("warning","No se encontro el articulo...");if(a.articulo[0].estado==0)return u.value=!1,c("warning","El articulo ya se vendio");if(a.articulo[0].pv_id!=y.pv_id)return u.value=!1,h.value="",c("warning","Este punto de venta no dispone de este articulo");e.value.some(m=>m.imei==a.articulo[0].imei)?c("warning","Ya fue agregado este articulo"):(a.articulo[0].detalle="",a.articulo[0].precio_venta=0,a.articulo[0].estado_ingreso=0,e.value.unshift(a.articulo[0]),h.value=""),u.value=!1}catch(a){console.log(a),u.value=!1}},U=a=>{let r=parseFloat(a.precio_venta)-parseFloat(a.precio_base.toFixed(2));const m=e.value.findIndex(w=>w.imei==a.imei);e.value[m].estado_ingreso=r.toFixed(2)},B=a=>{const r=e.value.findIndex(m=>m.id==a);e.value.splice(r,1)},D=async()=>{b.value=!0;try{const{data:{numeroSecuencial:a}}=await V.get("/ventas/getNoFactura");i.value.numComprobante=`001-${y.punto_emision}-${a}`}catch(a){console.log(a)}b.value=!1},k=async()=>{v.value=!1;try{const{data:{clientes:a}}=await V.get("/clientes");l.value=[],a.forEach(r=>{r.nombres!="CONSUMIDOR FINAL"&&l.value.push({label:r.nombres,value:r.id,cedula:r.num_documento})}),l.value.push({label:"CONSUMIDOR FINAL",value:0,cedula:"0"}),$=l.value}catch(a){console.log(a)}},N=H(()=>{let a=0;return e.value.forEach(r=>a+=parseFloat(r.precio_venta)),a.toFixed(2)}),L=async()=>{if(e.value.length==0)return c("warning","Debes agregar algun producto..");i.value.usuario_id=y.id,i.value.pv_id=y.pv_id,i.value.detalle=e.value,i.value.subTotal="0.00",i.value.iva="0.00",i.value.totalPago=N.value;try{f.dialog({title:"\xBFDeseas Agregar esta Venta?",ok:{push:!0,label:"Agregar"},cancel:{push:!0,color:"blue-grey-6",label:"Cancelar"}}).onOk(async()=>{f.loading.show({message:"Cargando..."}),await V.post("/ventas/add",i.value),f.loading.hide(),c("positive","Venta realizado exitosamente"),M.push("/ventas")})}catch(a){console.log(a),f.loading.hide()}};return D(),k(),{cambiarEstadoIngreso:U,columns:ye,formVenta:i,fechaActual:o,filterByIMEI:h,filterArticulo:T,listClientes:l,loadingState:u,getClientes:k,modalAgregarCliente:v,numFacturaCargado:b,rows:e,router:M,filterFn(a,r){if(a===""){r(()=>{l.value=$});return}r(()=>{const m=a.toLowerCase();l.value=l.value.filter(w=>w.cedula.indexOf(m)>-1||w.label.toLowerCase().indexOf(m)>-1)})},onSubmit:L,totalPago:N,quitarArticulo:B}}}),g=e=>(le("data-v-f104ffcc"),e=e(),se(),e),Ce={class:"row q-my-lg q-pl-md"},Ie={class:"col-md-6"},Ae={class:"text-h5 text-weight-medium"},Ve={class:"text-weight-regular"},Se={class:"col-md-6 text-right"},xe={class:"q-mr-lg text-h5 text-weight-medium"},Fe=g(()=>t("span",{class:"q-mr-sm"},"N\xB0 Factura:",-1)),Me={key:1,class:"text-weight-regular"},ke={class:"col-md-5 q-mt-lg"},Ne=g(()=>t("label",null,"Seleccionar Cliente:",-1)),Qe={class:"col-md-4 q-mt-lg btnAddCliente"},qe={class:"row q-my-lg q-pl-md"},$e={class:"col-md-5"},Ee=g(()=>t("label",null,"Filtrar por c\xF3digo IMEI:",-1)),Oe={class:"row"},Te={class:"col-md-12"},Ue={class:"q-pa-md"},Be={class:"full-width row flex-center text-lime-10 q-gutter-sm"},De=g(()=>t("span",{class:"text-subtitle1"}," Agrega alg\xFAn Producto ",-1)),Le={class:"col-md-12",style:{display:"flex","justify-content":"end"}},Pe={style:{"margin-right":"30px"}},ze=g(()=>t("tr",{class:"text-right"},[t("td",null,[t("b",null,"SUBTOTAL:")]),t("td",{style:{width:"90px"},class:"text-subtitle1 text-weight-regular"},"$0.00")],-1)),Re=g(()=>t("tr",{class:"text-right"},[t("td",{class:"q-py-sm"},[t("b",null,"IVA(12%):")]),t("td",{style:{width:"90px"},class:"q-py-sm text-subtitle1 text-weight-regular"},"$0.00")],-1)),Ye={class:"text-right"},Ke=g(()=>t("td",null,[t("b",null,"TOTAL A PAGAR:")],-1)),je={style:{width:"90px"}},Ge={class:"col-md-4 offset-4"};function He(e,l,v,b,u,c){const f=J("Add");return C(),Q(X,null,[s(me,null,{default:n(()=>[t("div",Ce,[t("div",Ie,[t("label",Ae,[S("Fecha de Emisi\xF3n: "),t("span",Ve,I(e.fechaActual),1)])]),t("div",Se,[t("label",xe,[Fe,e.numFacturaCargado?(C(),q(be,{key:0,color:"primary",class:"q-ml-md",size:"2em"})):(C(),Q("span",Me,I(e.formVenta.numComprobante),1))])]),t("div",ke,[Ne,s(re,{color:"orange",filled:"",modelValue:e.formVenta.cliente_id,"onUpdate:modelValue":l[1]||(l[1]=o=>e.formVenta.cliente_id=o),options:e.listClientes,"emit-value":"","map-options":"",onFilter:e.filterFn,"use-input":"","input-debounce":"0"},Z({"no-option":n(()=>[s(ne,null,{default:n(()=>[s(ie,{class:"text-grey"},{default:n(()=>[S(" No hay resultados ")]),_:1})]),_:1})]),_:2},[e.formVenta.cliente_id&&e.formVenta.cliente_id!=="CONSUMIDOR FINAL"?{name:"append",fn:n(()=>[s(A,{name:"cancel",onClick:l[0]||(l[0]=ee(o=>e.formVenta.cliente_id="CONSUMIDOR FINAL",["stop","prevent"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","options","onFilter"])]),t("div",Qe,[s(x,{round:"",color:"secondary",onClick:l[2]||(l[2]=o=>e.modalAgregarCliente=!0),icon:"person_add"})])]),t("div",qe,[t("div",$e,[Ee,s(F,{outlined:"","bottom-slots":"",loading:e.loadingState,modelValue:e.filterByIMEI,"onUpdate:modelValue":l[4]||(l[4]=o=>e.filterByIMEI=o),modelModifiers:{trim:!0},onKeyup:te(e.filterArticulo,["enter"])},{append:n(()=>[e.filterByIMEI!==""?(C(),q(A,{key:0,name:"close",onClick:l[3]||(l[3]=o=>e.filterByIMEI=""),class:"cursor-pointer"})):ae("",!0),s(A,{name:"search"})]),_:1},8,["loading","modelValue","onKeyup"])])]),s(ce,{onSubmit:e.onSubmit},{default:n(()=>[t("div",Oe,[t("div",Te,[t("div",Ue,[s(de,{rows:e.rows,columns:e.columns,"row-key":"name"},{"no-data":n(({})=>[t("div",Be,[De,s(A,{size:"2em",name:"playlist_add"})])]),"body-cell-precio_base":n(o=>[s(_,{props:o},{default:n(()=>[S(" $"+I(o.row.precio_base.toFixed(2)),1)]),_:2},1032,["props"])]),"body-cell-detalle":n(o=>[s(_,{props:o},{default:n(()=>[s(F,{"input-class":"text-center",dense:"",modelValue:o.row.detalle,"onUpdate:modelValue":i=>o.row.detalle=i,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-precio_venta":n(o=>[s(_,{props:o},{default:n(()=>[s(F,{"input-class":"text-center",dense:"",required:"",min:"1",step:"0.01",type:"number",style:{width:"100px"},modelValue:o.row.precio_venta,"onUpdate:modelValue":i=>o.row.precio_venta=i,modelModifiers:{trim:!0},onChange:i=>e.cambiarEstadoIngreso(o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["props"])]),"body-cell-estado_ingreso":n(o=>[s(_,{props:o},{default:n(()=>[t("label",{class:oe(o.row.estado_ingreso>0?"text-subtitle1 text-positive text-weight-medium":"text-subtitle1 text-negative text-weight-medium")}," $"+I(o.row.estado_ingreso),3)]),_:2},1032,["props"])]),"body-cell-acciones":n(o=>[s(_,{props:o},{default:n(()=>[s(x,{round:"",color:"deep-orange",onClick:i=>e.quitarArticulo(o.row.id),icon:"close",size:"8px"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])])]),t("div",Le,[t("table",Pe,[ze,Re,t("tr",Ye,[Ke,t("td",je,[s(ue,{outline:"",class:"text-subtitle1 text-weight-bold",color:"secondary",label:`$${e.totalPago}`},null,8,["label"])])])])]),t("div",Ge,[s(x,{square:"",color:"positive",type:"submit",label:"Agregar Venta",class:"full-width",icon:"shopping_cart"})])])]),_:1},8,["onSubmit"])]),_:1}),s(W,{modelValue:e.modalAgregarCliente,"onUpdate:modelValue":l[5]||(l[5]=o=>e.modalAgregarCliente=o)},{default:n(()=>[s(f,{onActualizarLista:e.getClientes},null,8,["onActualizarLista"])]),_:1},8,["modelValue"])],64)}var it=Y(we,[["render",He],["__scopeId","data-v-f104ffcc"]]);export{it as default};
